# GOOGLE_PRIVATE_KEY ä¿®æ­£ - æœ€é€Ÿã‚¬ã‚¤ãƒ‰

## ðŸš€ å•é¡Œ

Cloud Runã®ç’°å¢ƒå¤‰æ•°ç”»é¢ã§**æ”¹è¡ŒãŒå…¥åŠ›ã§ããªã„**ãŸã‚ã€`GOOGLE_PRIVATE_KEY`ãŒæ­£ã—ãè¨­å®šã§ããšã€
æ–‡å­—èµ·ã“ã—ãŒå¤±æ•—ã—ã¦ã„ã¾ã™ã€‚

**ã‚¨ãƒ©ãƒ¼:** `error:1E08010C:DECODER routines::unsupported`

## âœ… è§£æ±ºæ–¹æ³•ï¼ˆæœ€ã‚‚ç°¡å˜ï¼‰

### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ

```bash
cd /Users/Yoshi/Desktop/Cursorã§Webã‚¢ãƒ—ãƒªé–‹ç™º/Darwin-project
./fix-cloud-run-key-simple.sh
```

### ã‚¹ãƒ†ãƒƒãƒ—2: ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ `y` ã‚’å…¥åŠ›

```
ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N): y
```

### ã‚¹ãƒ†ãƒƒãƒ—3: å®Œäº†ï¼

ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰ï¼ˆ1-2åˆ†ï¼‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§æ–‡å­—èµ·ã“ã—ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚

## ðŸ“Š ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‹•ä½œ

1. âœ… Cloud Runã‹ã‚‰ç¾åœ¨ã®`GOOGLE_PRIVATE_KEY`ã‚’å–å¾—
2. âœ… `\n`ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸæ”¹è¡Œï¼‰ã‚’å®Ÿéš›ã®æ”¹è¡Œã«å¤‰æ›
3. âœ… å¤‰æ›å¾Œã®å€¤ã§Cloud Runã‚’æ›´æ–°
4. âœ… è‡ªå‹•ã§å†ãƒ‡ãƒ—ãƒ­ã‚¤

## ðŸ§ª å‹•ä½œç¢ºèª

### æ–¹æ³•1: APIã§ç¢ºèª

```bash
curl -s https://darwin-project-574364248563.asia-northeast1.run.app/api/check-env | python3 -m json.tool
```

`privateKey.status`ãŒ`"ok"`ã«ãªã£ã¦ã„ã‚Œã°OKã§ã™ã€‚

### æ–¹æ³•2: æ–‡å­—èµ·ã“ã—ã‚’ãƒ†ã‚¹ãƒˆ

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§æ–‡å­—èµ·ã“ã—ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
2. éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. ã€Œæ–‡å­—èµ·ã“ã—ã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã‘ã‚Œã°æˆåŠŸï¼

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "gcloud ã‚³ãƒžãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"

**å¯¾å‡¦æ³•:**
```bash
# Google Cloud SDKã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
# Macã®å ´åˆ:
brew install --cask google-cloud-sdk

# ã¾ãŸã¯å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰:
# https://cloud.google.com/sdk/docs/install
```

### ã‚¨ãƒ©ãƒ¼: "GOOGLE_PRIVATE_KEY ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"

**å¯¾å‡¦æ³•:**

Cloud Runã®ç’°å¢ƒå¤‰æ•°ã«`GOOGLE_PRIVATE_KEY`ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

1. Google Cloud Consoleã§ç¢ºèª:
   https://console.cloud.google.com/run

2. `darwin-project`ã‚µãƒ¼ãƒ“ã‚¹ã‚’é¸æŠž

3. ã€Œå¤‰æ•°ã¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã€ã‚¿ãƒ–ã§`GOOGLE_PRIVATE_KEY`ãŒã‚ã‚‹ã‹ç¢ºèª

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã§ããªã„

**å¯¾å‡¦æ³•:**
```bash
# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸Ž
chmod +x fix-cloud-run-key-simple.sh

# å†å®Ÿè¡Œ
./fix-cloud-run-key-simple.sh
```

## ðŸ“š ä»£æ›¿æ–¹æ³•

### æ–¹æ³•2: ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨

ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚­ãƒ¼JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹å ´åˆï¼š

```bash
./update-cloud-run-key.sh
```

ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ï¼š
- JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ç§˜å¯†éµã‚’æŠ½å‡º
- æ­£ã—ã„ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆã§è¨­å®š
- è‡ªå‹•æ¤œè¨¼æ©Ÿèƒ½ä»˜ã

### æ–¹æ³•3: æ‰‹å‹•ã§gcloud CLIã‚’ä½¿ç”¨

```bash
# 1. ç§˜å¯†éµã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ï¼ˆæ”¹è¡Œã‚’å«ã‚€ï¼‰
cat > /tmp/private_key.txt << 'EOF'
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQC...
ï¼ˆå®Ÿéš›ã®ç§˜å¯†éµï¼‰
-----END PRIVATE KEY-----
EOF

# 2. Cloud Runã‚’æ›´æ–°
gcloud run services update darwin-project \
  --region asia-northeast1 \
  --update-env-vars "GOOGLE_PRIVATE_KEY=$(cat /tmp/private_key.txt)"

# 3. ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
rm /tmp/private_key.txt
```

## ðŸŽ¯ ã¾ã¨ã‚

**æœ€ã‚‚ç°¡å˜ãªæ–¹æ³•:**
```bash
./fix-cloud-run-key-simple.sh
```

ã“ã‚Œã§å®Œäº†ã§ã™ï¼

---

**æ‰€è¦æ™‚é–“:** ç´„2åˆ†
**é›£æ˜“åº¦:** â­â˜†â˜†â˜†â˜†ï¼ˆéžå¸¸ã«ç°¡å˜ï¼‰
**å‰ææ¡ä»¶:** Google Cloud SDKãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨

